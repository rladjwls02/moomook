{
  "version": "1.0.0",
  "schemas": {
    "extract_constraints": {
      "type": "object",
      "additionalProperties": false,
      "required": ["constraints", "followUpQuestion"],
      "properties": {
        "constraints": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "spicy_preference",
            "spicy_min",
            "spicy_max",
            "desired_tags",
            "avoid_tags",
            "exclude_ingredients",
            "allergens",
            "max_cook_time_min",
            "budget_max",
            "portion_preference",
            "notes"
          ],
          "properties": {
            "spicy_preference": {
              "type": "string",
              "enum": ["any", "mild", "medium", "hot"]
            },
            "spicy_min": { "type": "integer", "minimum": 0, "maximum": 3 },
            "spicy_max": { "type": "integer", "minimum": 0, "maximum": 3 },
            "desired_tags": {
              "type": "array",
              "items": { "type": "string" },
              "maxItems": 10
            },
            "avoid_tags": {
              "type": "array",
              "items": { "type": "string" },
              "maxItems": 10
            },
            "exclude_ingredients": {
              "type": "array",
              "items": { "type": "string" },
              "maxItems": 10
            },
            "allergens": {
              "type": "array",
              "items": { "type": "string" },
              "maxItems": 10
            },
            "max_cook_time_min": {
              "type": ["integer", "null"],
              "minimum": 1,
              "maximum": 120
            },
            "budget_max": {
              "type": ["integer", "null"],
              "minimum": 1000,
              "maximum": 300000
            },
            "portion_preference": {
              "type": "string",
              "enum": ["any", "light", "filling"]
            },
            "notes": { "type": "string", "maxLength": 200 }
          }
        },
        "followUpQuestion": {
          "type": ["string", "null"],
          "maxLength": 80,
          "description": "불확실할 때만 질문 1개. 아니면 null."
        }
      }
    },
    "generate_explanations": {
      "type": "object",
      "additionalProperties": false,
      "required": ["items", "globalNote"],
      "properties": {
        "items": {
          "type": "array",
          "minItems": 1,
          "maxItems": 5,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["menuId", "reason"],
            "properties": {
              "menuId": { "type": "integer" },
              "reason": { "type": "string", "maxLength": 180 }
            }
          }
        },
        "globalNote": {
          "type": "string",
          "maxLength": 200,
          "description": "전체적으로 한 줄 코멘트(선택이지만 고정 필드로 둠)."
        }
      }
    }
  }
}
